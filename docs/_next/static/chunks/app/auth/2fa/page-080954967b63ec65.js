(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[392,817],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},314:(e,t,r)=>{Promise.resolve().then(r.bind(r,1798))},1798:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(5155),s=r(2115),i=r(63),n=r(5392),l=r(6948),c=r(8332);let o=(0,r(1847).A)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);var d=r(2529);function u(e){let{onVerified:t}=e,[r,i]=(0,s.useState)(""),[u,f]=(0,s.useState)(""),[m,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)([]),[y,x]=(0,s.useState)(""),[v,b]=(0,s.useState)(!0);(0,s.useEffect)(()=>{N()},[]);let N=async()=>{try{let e=await (0,n.createSPASassClient)(),{data:t,error:r}=await e.getSupabaseClient().auth.mfa.listFactors();if(r)throw r;let a=t.totp||[];g(a),console.log("totpFactors:",a),1===a.length&&x(a[0].id)}catch(e){console.error("Error loading MFA factors:",e),f("Failed to load authentication devices")}finally{b(!1)}},w=async()=>{if(!y)return void f("Please select an authentication device");f(""),h(!0);try{let e=(await (0,n.createSPASassClient)()).getSupabaseClient(),{data:a,error:s}=await e.auth.mfa.challenge({factorId:y});if(s)throw s;let{error:i}=await e.auth.mfa.verify({factorId:y,challengeId:a.id,code:r});if(i)throw i;t()}catch(e){console.error("MFA verification error:",e),f(e instanceof Error?e.message:"Failed to verify MFA code")}finally{h(!1)}};return v?(0,a.jsx)(l.Zp,{className:"w-full",children:(0,a.jsx)(l.Wu,{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})}):0===p.length?(0,a.jsx)(l.Zp,{className:"w-full",children:(0,a.jsx)(l.Wu,{className:"py-8",children:(0,a.jsx)(c.Fc,{variant:"destructive",children:(0,a.jsx)(c.TN,{children:"No authentication devices found. Please contact support."})})})}):(0,a.jsxs)(l.Zp,{className:"w-full",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Two-Factor Authentication Required"}),(0,a.jsx)(l.BT,{children:"Please enter the verification code from your authenticator app"})]}),(0,a.jsxs)(l.Wu,{children:[u&&(0,a.jsx)(c.Fc,{variant:"destructive",className:"mb-4",children:(0,a.jsx)(c.TN,{children:u})}),(0,a.jsxs)("div",{className:"space-y-4",children:[p.length>1&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Select Authentication Device"}),(0,a.jsx)("div",{className:"grid gap-3",children:p.map(e=>(0,a.jsxs)("button",{onClick:()=>x(e.id),className:"flex items-center space-x-3 p-3 border rounded-lg transition-colors ".concat(y===e.id?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 hover:border-primary-200 hover:bg-gray-50"),children:[(0,a.jsx)(o,{className:"h-5 w-5"}),(0,a.jsxs)("div",{className:"flex-1 text-left",children:[(0,a.jsx)("p",{className:"font-medium",children:e.friendly_name||"Authenticator Device"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Added on ",new Date(e.created_at).toLocaleDateString()]})]}),y===e.id&&(0,a.jsx)(d.A,{className:"h-5 w-5 text-primary-500"})]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Verification Code"}),(0,a.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value.trim()),className:"block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-primary-500 sm:text-sm",placeholder:"Enter 6-digit code",maxLength:6}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Enter the 6-digit code from your authenticator app"})]}),(0,a.jsx)("button",{onClick:w,disabled:m||6!==r.length||!y,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:m?"Verifying...":"Verify"})]})]})]})}function f(){let e=(0,i.useRouter)(),[t,r]=(0,s.useState)(!0),[l,c]=(0,s.useState)(""),o=(0,s.useCallback)(async()=>{try{let t=(await (0,n.createSPASassClient)()).getSupabaseClient(),{data:{user:a},error:s}=await t.auth.getUser();if(s||!a)return void e.push("/auth/login");let{data:i,error:l}=await t.auth.mfa.getAuthenticatorAssuranceLevel();if(l)throw l;if("aal2"===i.currentLevel||"aal1"===i.nextLevel)return void e.push("/kybalion/");r(!1)}catch(e){c(e instanceof Error?e.message:"An error occurred"),r(!1)}},[e]);return((0,s.useEffect)(()=>{o()},[o]),t)?(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):l?(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("div",{className:"text-red-600",children:l})}):(0,a.jsx)("div",{className:"w-full max-w-md",children:(0,a.jsx)(u,{onVerified:()=>{e.push("/kybalion/")}})})}},2529:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(1847).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3101:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var a=r(2821);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,i=a.$,n=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return i(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:n,defaultVariants:l}=t,c=Object.keys(n).map(e=>{let t=null==r?void 0:r[e],a=null==l?void 0:l[e];if(null===t)return null;let i=s(t)||s(a);return n[e][i]}),o=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return i(e,c,null==t||null==(a=t.compoundVariants)?void 0:a.reduce((e,t)=>{let{class:r,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...o}[t]):({...l,...o})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},4269:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var a=r(2821),s=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},5392:(e,t,r)=>{"use strict";r.d(t,{q:()=>n,createSPASassClient:()=>l,X:()=>c});var a=r(6620),s=function(e){return e.SERVER="server",e.SPA="spa",e}({});class i{async loginEmail(e,t){return this.client.auth.signInWithPassword({email:e,password:t})}async registerEmail(e,t){return this.client.auth.signUp({email:e,password:t})}async exchangeCodeForSession(e){return this.client.auth.exchangeCodeForSession(e)}async resendVerificationEmail(e){return this.client.auth.resend({email:e,type:"signup"})}async logout(){let{error:e}=await this.client.auth.signOut({scope:"local"});if(e)throw e;"spa"===this.clientType&&(window.location.href="/auth/login")}async uploadFile(e,t,r){return t=e+"/"+(t=t.replace(/[^0-9a-zA-Z!\-_.*'()]/g,"_")),this.client.storage.from("files").upload(t,r)}async getFiles(e){return this.client.storage.from("files").list(e)}async deleteFile(e,t){return t=e+"/"+t,this.client.storage.from("files").remove([t])}async shareFile(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t=e+"/"+t,this.client.storage.from("files").createSignedUrl(t,r,{download:a})}async getMyTodoList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"created_at",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.client.from("todo_list").select("*").range(e*t-t,e*t-1).order(r);return null!==a&&(s=s.eq("done",a)),s}async createTask(e){return this.client.from("todo_list").insert(e)}async removeTask(e){return this.client.from("todo_list").delete().eq("id",e)}async updateAsDone(e){return this.client.from("todo_list").update({done:!0}).eq("id",e)}getSupabaseClient(){return this.client}constructor(e,t){this.client=e,this.clientType=t}}function n(){return(0,a.createBrowserClient)("https://xcopajcpimrsqcqhydug.supabase.co","sb_publishable_pGN0njb-9XysERIUFiYtPg_NbAQuZGT")}async function l(){return new i(n(),s.SPA)}async function c(){let e=n(),t=await e.auth.getSession();return t.data&&t.data.session||(window.location.href="/auth/login"),new i(e,s.SPA)}},6948:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>c,Zp:()=>n,aR:()=>l});var a=r(5155),s=r(2115),i=r(4269);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});c.displayName="CardTitle";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});o.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},8332:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>c,TN:()=>o});var a=r(5155),s=r(2115),i=r(3101),n=r(4269);let l=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,...i}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(l({variant:s}),r),...i})});c.displayName="Alert",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",r),...s})}).displayName="AlertTitle";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",r),...s})});o.displayName="AlertDescription"}},e=>{e.O(0,[620,779,441,255,358],()=>e(e.s=314)),_N_E=e.O()}]);