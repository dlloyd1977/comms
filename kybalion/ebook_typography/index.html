<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The Kybalion — Annotated Facilitator Edition</title>
    <meta
      name="description"
      content="Annotated, stanza-based edition of The Kybalion with hyperlinked table of contents, tagging, and printable layout."
    />
    <link rel="canonical" href="https://comms.davidelloyd.com/kybalion/ebook_typography/" />
    <meta property="og:title" content="The Kybalion — Annotated Facilitator Edition" />
    <meta
      property="og:description"
      content="Stanza-based, hyperlinked edition with tags, TOC, and print-to-PDF support."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://comms.davidelloyd.com/kybalion/ebook_typography/" />
    <meta property="og:image" content="https://comms.davidelloyd.com/kybalion/images/preview.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="The Kybalion — Annotated Facilitator Edition" />
    <meta
      name="twitter:description"
      content="Stanza-based, hyperlinked edition with tags, TOC, and print-to-PDF support."
    />
    <meta name="twitter:image" content="https://comms.davidelloyd.com/kybalion/images/preview.png" />
    <link rel="stylesheet" href="styles.css?v=1.11.1" />
  </head>
  <body
    data-supabase-url="https://xcopajcpimrsqcqhydug.supabase.co"
    data-supabase-anon-key="sb_publishable_pGN0njb-9XysERIUFiYtPg_NbAQuZGT"
    data-admin-emails="davidelloydjr@gmail.com"
  >
    <header class="page-header">
      <div class="header-content">
        <div>
          <p class="eyebrow">Annotated Facilitator Edition</p>
          <h1>The Kybalion</h1>
          <p class="subtitle">
            Stanza-based reference text with hyperlinked TOC, tags, and print-ready layout.
          </p>
        </div>
        <div class="header-actions">
          <button class="secondary" type="button" id="authOpenBtn">Sign In / Create Account</button>
          <span class="user-display is-hidden" id="userDisplay" aria-live="polite"></span>
          <button class="secondary is-hidden" type="button" id="headerSignOutBtn">Log out</button>
          <button class="primary" type="button" id="printBtn">Print / Save as PDF</button>
          <button class="secondary" type="button" id="layoutEditBtn">Edit layout</button>
          <button class="secondary" type="button" id="layoutResetBtn">Reset layout</button>
          <a class="secondary" href="#toc" id="tocJump">Jump to TOC</a>
        </div>
      </div>
      <div class="controls">
        <label class="control search-control" data-layout-key="search">
          <span>Search</span>
          <div class="search-row">
            <input type="search" id="searchInput" placeholder="Search the text..." />
            <button class="secondary search-button" type="button" id="searchBtn">Search</button>
          </div>
        </label>
        <label class="control" data-layout-key="tag">
          <span>Tag filter</span>
          <select id="tagFilter">
            <option value="">All tags</option>
          </select>
        </label>
        <div class="control view-toggle" aria-label="View mode" data-layout-key="view">
          <span>View</span>
          <div class="view-toggle-pill" role="tablist" aria-label="View mode">
            <button
              class="view-pill-button is-active"
              type="button"
              id="viewModeStandardBtn"
              data-mode="standard"
              role="tab"
              aria-selected="true"
            >
              Standard
            </button>
            <button
              class="view-pill-button"
              type="button"
              id="viewModeStanzaBtn"
              data-mode="typography"
              role="tab"
              aria-selected="false"
            >
              Stanza
            </button>
          </div>
        </div>
        <label class="toggle" data-layout-key="pages">
          <input type="checkbox" id="togglePages" checked />
          <span>Show page numbers</span>
        </label>
        <label class="toggle" data-layout-key="refs">
          <input type="checkbox" id="toggleRefs" checked />
          <span>Show stanza references</span>
        </label>
        <div class="standard-tools header-reader-tools" id="standardTools" data-layout-key="reader-tools">
          <span class="standard-tools-label">Reader tools</span>
          <button class="secondary" type="button" id="standardSaveHighlightBtn">
            Save highlight as Note
          </button>
          <button class="secondary" type="button" id="standardAddTagBtn">Add Tag</button>
          <button class="secondary" type="button" id="standardAnnotateBtn">Annotate</button>
          <button class="secondary" type="button" id="standardViewNotesBtn">View Notes</button>
        </div>
      </div>
    </header>

    <main class="layout" id="typographyView">
      <aside class="toc" id="toc">
        <div class="toc-header">
          <h2>Table of Contents</h2>
          <p>Tap a chapter to jump to stanza references.</p>
        </div>
        <nav id="tocList" class="toc-list" aria-label="Table of Contents"></nav>
      </aside>

      <section class="content" id="content">
        <div class="loading" id="loading">Loading annotated text…</div>
      </section>
    </main>

    <section class="standard-view is-hidden" id="standardView" aria-hidden="true">
      <div class="standard-layout">
        <aside class="toc standard-toc" id="standardToc">
          <div class="toc-header">
            <h2>Table of Contents</h2>
            <p>Tap a chapter to jump to the text.</p>
          </div>
          <nav id="standardTocList" class="toc-list" aria-label="Standard Table of Contents"></nav>
        </aside>
        <div class="standard-content" id="standardContent"></div>
      </div>
    </section>

    <div class="notes-modal" id="notesModal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="notes-modal-card" role="document">
        <div class="notes-header">
          <div>
            <h2 id="notesTitle">Notes</h2>
            <p>Highlights saved from the text appear here.</p>
          </div>
          <div class="notes-modal-actions">
            <button class="secondary" type="button" id="copyNotesBtn">Copy All Notes</button>
            <button class="secondary" type="button" id="closeNotesBtn">Close</button>
          </div>
        </div>
        <div class="auth-panel" id="authPanel">
          <div class="auth-flow" id="authFlow">
            <div class="auth-step is-active" data-step="choice">
              <p class="auth-step-title">Choose how you want to continue</p>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authChoiceSignInBtn">Sign in</button>
                <button class="secondary" type="button" id="authChoiceSignUpBtn">Create account</button>
                <button class="secondary" type="button" id="authChoiceGuestBtn">Continue as Guest</button>
              </div>
            </div>

            <div class="auth-step" data-step="signin">
              <p class="auth-step-title">Sign in</p>
              <div class="auth-row">
                <label class="control auth-control">
                  <span>Email</span>
                  <input type="email" id="authEmail" placeholder="you@example.com" />
                </label>
                <label class="control auth-control">
                  <span>Password</span>
                  <input type="password" id="authPassword" placeholder="Password" />
                </label>
              </div>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authSignInBtn">Sign in</button>
                <button class="secondary" type="button" id="authResetPasswordBtn">Reset Password</button>
                <button class="secondary" type="button" id="authBackFromSignInBtn">Back</button>
              </div>
            </div>

            <div class="auth-step" data-step="reset">
              <p class="auth-step-title">Reset Password</p>
              <div class="auth-row">
                <label class="control auth-control">
                  <span>Email</span>
                  <input type="email" id="authResetEmail" placeholder="you@example.com" />
                </label>
              </div>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authSendResetBtn">Send Reset Link</button>
                <button class="secondary" type="button" id="authBackFromResetBtn">Back</button>
              </div>
            </div>

            <div class="auth-step" data-step="reset-password">
              <p class="auth-step-title">Set New Password</p>
              <div class="auth-row">
                <label class="control auth-control">
                  <span>New password</span>
                  <input type="password" id="authNewPassword" placeholder="New password" />
                </label>
              </div>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authSetNewPasswordBtn">Update Password</button>
                <button class="secondary" type="button" id="authBackFromNewPasswordBtn">Back</button>
              </div>
            </div>

            <div class="auth-step" data-step="signup">
              <p class="auth-step-title">Create account</p>
              <div class="auth-row">
                <label class="control auth-control">
                  <span>Email</span>
                  <input type="email" id="authSignUpEmail" placeholder="you@example.com" />
                </label>
                <label class="control auth-control">
                  <span>Password</span>
                  <input type="password" id="authSignUpPassword" placeholder="Password" />
                </label>
              </div>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authSignUpBtn">Create account</button>
                <button class="secondary" type="button" id="authBackFromSignUpBtn">Back</button>
              </div>
            </div>

            <div class="auth-step" data-step="guest">
              <p class="auth-step-title">Continue as Guest</p>
              <p class="auth-warning">
                Guest mode keeps notes only on this device and may be cleared by the browser.
              </p>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authGuestBtn">Continue as Guest</button>
                <button class="secondary" type="button" id="authBackFromGuestBtn">Back</button>
              </div>
            </div>

            <div class="auth-step" data-step="confirm">
              <p class="auth-step-title">All set</p>
              <p class="auth-confirm" id="authConfirmMessage"></p>
              <div class="auth-actions">
                <button class="secondary" type="button" id="authConfirmBtn">Continue to Notes</button>
                <button class="secondary" type="button" id="authSignOutBtn">Sign out</button>
              </div>
            </div>
          </div>

          <p class="auth-status is-info" id="authStatus">Sync not configured.</p>
          <p class="auth-warning" id="authWarning">
            Guest mode keeps notes only on this device and may be cleared by the browser.
          </p>
        </div>
        <div class="notes-content" id="notesContent">
          <div id="notesList" class="notes-list"></div>
        </div>
      </div>
    </div>

    <div class="annotation-modal" id="annotationModal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="annotation-modal-card" role="document">
        <div class="annotation-header">
          <div>
            <h2>Annotation</h2>
            <p id="annotationRef">Stanza</p>
          </div>
          <div class="annotation-actions">
            <span class="annotation-count" id="annotationCount">0 / 500</span>
            <button class="secondary" type="button" id="annotationCloseBtn">Close</button>
          </div>
        </div>
        <label class="annotation-field">
          <span>Your notes</span>
          <textarea id="annotationInput" maxlength="500" placeholder="Write your annotation..."></textarea>
        </label>
        <p class="annotation-status" id="annotationStatus">Saved.</p>
      </div>
    </div>

    <footer class="page-footer">
      <p>
        Text sourced from the provided PDF and segmented into stanza references for study and discussion.
        Use Print / Save as PDF for downloadable copies.
      </p>
      <p class="version">Version <span id="appVersion"></span></p>
    </footer>

    <script src="app.js?v=1.11.1" type="module"></script>
  </body>
</html>
